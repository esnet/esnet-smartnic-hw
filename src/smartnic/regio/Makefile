# -----------------------------------------------
# Component setup
# -----------------------------------------------
COMPONENT_ROOT := ..

include $(COMPONENT_ROOT)/config.mk

APP_ROOT ?= $(PROJ_ROOT)/src/smartnic_app/blackbox

# -----------------------------------------------
# Regmap YAML sources
#   List regio yaml block and decoder specification sources.
#   RTL is autogenerated for all yaml files listed.
# -----------------------------------------------
REG_BLOCK_YAML = \
    smartnic.yaml \
    smartnic_hash2qid.yaml

REG_DECODER_YAML = \
    smartnic_cmac_decoder.yaml \
    smartnic_host_decoder.yaml \
    smartnic_bypass_decoder.yaml \
    smartnic_app_decoder.yaml \
    smartnic_to_app_decoder.yaml \
    smartnic_p4_decoder.yaml \
    smartnic_decoder.yaml

# ----------------------------------------------------
# Options
# ----------------------------------------------------
REGIO_ELABORATE_OPTS :=
REGIO_GENERATE_OPTS :=

# ----------------------------------------------------
# Targets
# ----------------------------------------------------
all: reg compile synth

reg:     smartnic_app_decoder.yaml _reg
compile: _reg_compile
synth:   _reg_synth
info:    _reg_info
clean:   _reg_clean

.PHONY: all reg compile synth info clean

smartnic_app_decoder.yaml:
ifeq ($(abspath $(APP_ROOT)),$(abspath $(PROJ_ROOT)/src/smartnic_app/blackbox))
	@cp $(PROJ_ROOT)/src/smartnic_app/blackbox/regio/smartnic_app_decoder.yaml ./
else
	@$(MAKE) -s -C $(APP_ROOT)/app_if reg_package OUTPUT_ROOT=$(OUTPUT_ROOT)
	@cp $(APP_ROOT)/app_if/smartnic_app_decoder.yaml ./
endif
	@touch smartnic_decoder.yaml

.PHONY: smartnic_app_decoder.yaml

# -----------------------------------------------
# Include regio targets
# -----------------------------------------------
include $(SCRIPTS_ROOT)/Makefiles/regio.mk
