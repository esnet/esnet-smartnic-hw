# -----------------------------------------------
# Component setup
# -----------------------------------------------
COMPONENT_ROOT := ../../..

include $(COMPONENT_ROOT)/config.mk

# -----------------------------------------------
# Regmap YAML sources
#   List regio yaml block and decoder specification sources.
#   RTL is autogenerated for all yaml files listed.
# -----------------------------------------------
REG_BLOCK_YAML =
REG_DECODER_YAML =

# ----------------------------------------------------
# Options
# ----------------------------------------------------
REGIO_ELABORATE_OPTS :=
REGIO_GENERATE_OPTS :=

# ----------------------------------------------------
# Targets
# ----------------------------------------------------
all: reg compile synth

compile: _reg_compile
synth:   _reg_synth
info:    _reg_info
clean:   _reg_clean

.PHONY: all reg compile synth info clean

# -----------------------------------------------
# Include regio targets
# -----------------------------------------------
include $(SCRIPTS_ROOT)/Makefiles/regio.mk

reg:     _reg $(REGIO_IR_OUTPUT_DIR)/core_decoder-ir.yaml
	@$(REGIO_ELABORATE_CMD) -f top -i $(REGIO_IR_OUTPUT_DIR) -o $(REGIO_IR_OUTPUT_DIR)/esnet-smartnic-top-ir.yaml esnet-smartnic-top.yaml

$(REGIO_IR_OUTPUT_DIR)/core_decoder-ir.yaml:
	@$(MAKE) -s -C $(SRC_ROOT) reg COMPONENT=smartnic.regio APP_ROOT=$(SRC_ROOT)/core/hbmtest
	@mkdir -p $(REGIO_IR_OUTPUT_DIR)
	@echo $(REGIO_IR_OUTPUT_DIR)
	@cp $(OUTPUT_ROOT)/$(BOARD)/smartnic/regio/ir/smartnic_decoder-ir.yaml $@

